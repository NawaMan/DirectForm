<!DOCTYPE html>
<html>

<head>
<meta charset="UTF-8">
<title>DirectForm Demo</title>
<script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>

<script src="res/demo.js"></script>
<link   href="res/demo.css" type="text/css" rel="stylesheet" />

<script src="res/shCore.js"></script>
<script src="res/shBrushJScript.js"></script>
<script src="res/shBrushXml.js"></script>
<link   href="res/shCore.css"         type="text/css" rel="stylesheet" />
<link   href="res/shThemeDefault.css" type="text/css" rel="stylesheet" />

<script type="text/javascript" >
$(function () {
    // Prepare demo - not related to the Direct Form.
    demo.ready = false;
    demo.initModule();
});
</script>

<script src="../script/directForm.js"></script>
<script id="demo-js" type="text/javascript" >
// Gobal variable for testing
lastSubmitEvent = null;
theForm         = null;

$(function () {
    // Initiate the direct form module. (Need to don only once).
    directForm.initModule();
    
    // Create a direct form for the container "#form1"".
    var form1 = directForm.makeForm($("#form1"));
    // Make its submit button to perform a submit.
    $("#form1 > .submit-button").click(function() {
        form1.submit();
    });
    // Setup a listener for the form.
    $("#form1").bind('submit', function(event) {
        // Display the value.
        demo.log(JSON.stringify(event.values));
        // Store this for testing
        lastSubmitEvent = event;
    });
    
    theForm = form1;
});
</script>

<script id="Test-01" type="text/javascript" >
$(function () {
    demo.addUnitTest('Test-01', 'Check if the input values are as expected', function() {
        var $input1 = $("#form1 [data-name=input1]");
        var $input2 = $("#form1 [data-name=input2]");
        
        var oldValue1  = $input1.val();
        var oldValue2  = $input2.val();
        try {
            // Given 
            $input1.val("value1");
            $input2.val("value2");
            
            // Do it
            theForm.submit();
            
            // Ensure result
            demo.assert(lastSubmitEvent.values["input1"], "value1");
            demo.assert(lastSubmitEvent.values.input2,    "value2");
        } finally {
            $input1.val(oldValue1);
            $input2.val(oldValue2);
        }
    });
});
</script>

<script id="Test-02" type="text/javascript" >
$(function () {
    demo.addUnitTest('Test-02', 'Check if input values are as expected - by simulating and observing the UI', function() {
        var $input1 = $("#form1 [data-name=input1]");
        var $input2 = $("#form1 [data-name=input2]");
        var $submitBtn = $("#form1 .submit-button")
        
        var oldValue1  = $input1.val();
        var oldValue2  = $input2.val();
        try {
            // Given 
            $input1.val("value1");
            $input2.val("value2");
            
            // Do it
            theForm.submit();
            
            // Ensure result
            return demo.assertLog('{"input1":"value1","input2":"value2"}');
        } finally {
            $input1.val(oldValue1);
            $input2.val(oldValue2);
        }
    });
});
</script>

<script id="Test-03" type="text/javascript" >
$(function () {
    demo.addUnitTest('Test-03', 'Check if the fields are accessible', function() {
        var $input1 = $("#form1 [data-name=input1]");
        var $input2 = $("#form1 [data-name=input2]");
        
        var oldValue1  = $input1.val();
        var oldValue2  = $input2.val();
        try {
            // Given
            $input1.val("value1");
            $input2.val("value2");
            $input1.attr("data-uId", Math.floor(Math.random()*1000001));
            $input2.attr("data-uId", Math.floor(Math.random()*1000001));
            
            // Do it
            theForm.submit();
            
            // Ensure result
            demo.assert(lastSubmitEvent.fields["input1"].element.attr("data-uId"), $input1.attr("data-uId"));
            demo.assert(lastSubmitEvent.fields.input2.element.attr("data-uId"),    $input2.attr("data-uId"));
        } finally {
            $input1.val(oldValue1);
            $input2.val(oldValue2);
        }
    });
});
</script>

<script id="Test-04" type="text/javascript" >
$(function () {
    demo.addUnitTest('Test-04', 'Check if the fields values are accessible', function() {
        var $input1 = $("#form1 [data-name=input1]");
        var $input2 = $("#form1 [data-name=input2]");
        
        var oldValue1  = $input1.val();
        var oldValue2  = $input2.val();
        try {
            // Given
            $input1.val("value1");
            $input2.val("value2");
            
            // Do it
            theForm.submit();
            
            // Ensure result
            demo.assert(lastSubmitEvent.fields["input1"].value, "value1");
            demo.assert(lastSubmitEvent.fields.input2.value,    "value2");
        } finally {
            $input1.val(oldValue1);
            $input2.val(oldValue2);
        }
    });
});
</script>

<script type="text/javascript" >
$(function () {
    $("#disp-code-test-01 pre").text($("#Test-01").html());
    
    if (demo.param('unittests') != 'false') {
        demo.runUnitTests();
    }
    demo.ready = true;
});
</script>

</head>

<body>
  <div class="head" >
    <div>Basic</div>
    <div>
      <h3>Description</h3>
      <ul>
          <li>
              Direct form can be created from any container.
          </li>
          <li>
              When submit, the value of any input components (except for button) in that container are automatically
                gathered and added to the event object in the property named "values"
                (e.g., `<code>event.values['input1']</code>` or `<code>event.values.input1</code>`).
          </li>
          <li>
              The fields elements are also accessible via the property of the event object named "fields" 
                (e.g., `<code>event.fields['input1'].element</code>` or `<code>event.fields.input1.element</code>`).
          </li>
          <li>
              The fields values are also accessible via the `<code>fields</code>` property.
                (e.g., `<code>event.fields['input1'].value</code>` or `<code>event.fields.input1.value</code>`).
          </li>
      </ul>
      
      <div id="disp-code" class="has-detail">
        <h3>Demo Code</h3>
        <span class="show-link">&lt;show&gt;</span><span class="hide-link">&lt;hide&gt;</span>
        
        <div class="detail">
          <h4>HTML</h4>
          <div id="disp-html-code">
            <pre class="brush: xml"></pre>
          </div>
          
          <h4>JavaScript</h4>
          <div id="disp-js-code">
            <pre class="brush: js"></pre>
          </div>
          
          <h4>Test-01</h4>
          <div id="disp-code-test-01">
            <pre class="brush: js"></pre>
          </div>
        </div>
      </div>
      
      <div id="unit-tests" class="has-detail">
        <h3>Unit tests</h3>
        <span class="show-link">&lt;show&gt;</span><span class="hide-link">&lt;hide&gt;</span>
        
        <table class="detail">
        </table>
      </div>
    </div>
  </div>
  <div id="demo-html" class="content" >
    <div id="form1" >
      <input type="text" data-name="input1" placeholder="input1"><br/>
      <input type="text" data-name="input2" placeholder="input2"><br/>
      <input type="button" class="submit-button" value="Submit" />
    </div>
  </div>
  <div class="log" ></div>
</body>

</html>